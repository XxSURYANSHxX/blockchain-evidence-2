<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” EVID-DGC Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KEYDE0ZH4Z"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KEYDE0ZH4Z');
    </script>
</head>
<body>
    <div class="container">
        <div class="text-center p-8">
            <div class="loading mb-4"></div>
            <h2>ğŸ”„ Redirecting to your dashboard...</h2>
            <p>Please wait while we load your role-specific interface.</p>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="storage.js"></script>
    <script src="analytics.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            await routeToRoleDashboard();
        });

        async function routeToRoleDashboard() {
            try {
                const userAccount = localStorage.getItem('currentUser');
                console.log('Dashboard router - userAccount:', userAccount);
                
                if (!userAccount) {
                    console.log('No user account found, redirecting to index');
                    window.location.href = 'index.html';
                    return;
                }

                // Get user data
                let userInfo = null;
                
                // Try database first
                if (typeof storage !== 'undefined') {
                    try {
                        userInfo = await storage.getUser(userAccount);
                        console.log('User info from database:', userInfo);
                    } catch (error) {
                        console.log('Database not available, checking localStorage');
                    }
                }

                // Fallback to localStorage
                if (!userInfo) {
                    const savedUser = localStorage.getItem('evidUser_' + userAccount);
                    if (savedUser) {
                        userInfo = JSON.parse(savedUser);
                        console.log('User info from localStorage:', userInfo);
                    }
                }

                if (!userInfo) {
                    console.log('No user info found, redirecting to index');
                    window.location.href = 'index.html';
                    return;
                }

                // Route based on role
                const role = userInfo.role;
                console.log('User role:', role);
                let dashboardUrl = 'dashboard-public.html'; // default

                switch (role) {
                    case 'admin':
                    case 8:
                        dashboardUrl = 'admin.html';
                        break;
                    case 'investigator':
                    case 2:
                        dashboardUrl = 'dashboard-investigator.html';
                        break;
                    case 'forensic_analyst':
                    case 3:
                        dashboardUrl = 'dashboard-analyst.html';
                        break;
                    case 'legal_professional':
                    case 4:
                        dashboardUrl = 'dashboard-legal.html';
                        break;
                    case 'court_official':
                    case 5:
                        dashboardUrl = 'dashboard-court.html';
                        break;
                    case 'evidence_manager':
                    case 6:
                        dashboardUrl = 'dashboard-manager.html';
                        break;
                    case 'auditor':
                    case 7:
                        dashboardUrl = 'dashboard-auditor.html';
                        break;
                    case 'public_viewer':
                    case 1:
                    default:
                        dashboardUrl = 'dashboard-public.html';
                        break;
                }

                console.log(`Redirecting ${role} to ${dashboardUrl}`);
                
                // Add a small delay to ensure the redirect is visible
                setTimeout(() => {
                    window.location.href = dashboardUrl;
                }, 500);

            } catch (error) {
                console.error('Dashboard routing error:', error);
                alert('Error loading dashboard. Please try logging in again.');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
<nav class="navbar">
  <div class="navbar-left">
    <h2 class="navbar-logo" onclick="window.location.href='dashboard.html'">
      ğŸ” EVID-DGC
    </h2>
  </div>

  <div class="navbar-right">
    <span class="user-role" id="userRole">Role</span>
    <span class="user-wallet" id="userWallet">0x****...abc</span>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </div>
</nav>

</html>